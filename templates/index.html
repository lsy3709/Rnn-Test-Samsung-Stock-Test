<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>삼성 주가 예측</title>
</head>
<body>

<form id="periodForm">
    <label><input type="radio" name="period" value="1d"> 1일</label><br>
    <label><input type="radio" name="period" value="5d"> 5일</label><br>
    <label><input type="radio" name="period" value="1mo"> 1개월</label><br>
    <label><input type="radio" name="period" value="3mo"> 3개월</label><br>
    <label><input type="radio" name="period" value="6mo"> 6개월</label><br>
    <label><input type="radio" name="period" value="1y"> 1년</label><br>
    <button type="button" id="fetchDataButton">데이터 가져오기</button>
</form>
<div id="dataContainer"></div>

<h1>삼성 주가 예측 모델 (2일 데이터 입력)</h1>
<button onclick="autoFillData()">최근 2일치 데이터 자동 입력</button>
<br><br>

 <!--  기본 2일 치 데이터 입력란-->
<form id="predictForm">

    <!-- 첫 번째 날 데이터 입력 -->
    <h3 id="date1">첫 번째 날</h3>
    시작가: <input type="number" step="0.01" name="open_1" required><br>
    최소가: <input type="number" step="0.01" name="low_1" required><br>
    최대가: <input type="number" step="0.01" name="high_1" required><br>
    종가: <input type="number" step="0.01" name="close_1" required><br><br>

    <!-- 두 번째 날 데이터 입력 -->
    <h3 id="date2">두 번째 날</h3>
    시작가: <input type="number" step="0.01" name="open_2" required><br>
    최소가: <input type="number" step="0.01" name="low_2" required><br>
    최대가: <input type="number" step="0.01" name="high_2" required><br>
    종가: <input type="number" step="0.01" name="close_2" required><br><br>

    <button type="button" onclick="makePrediction()">예측하기</button>
</form>

<!-- 예측 결과 표시 -->
<h2 id="predictionResult"></h2>

<script>
    // 입력 데이터를 JSON 형식으로 변환하여 서버로 전송
    function makePrediction() {
        // 첫 번째 날과 두 번째 날의 입력 값을 배열로 수집
        const data = [
            [
                parseFloat(document.querySelector('[name="open_1"]').value),
                parseFloat(document.querySelector('[name="low_1"]').value),
                parseFloat(document.querySelector('[name="high_1"]').value),
                parseFloat(document.querySelector('[name="close_1"]').value)
            ],
            [
                parseFloat(document.querySelector('[name="open_2"]').value),
                parseFloat(document.querySelector('[name="low_2"]').value),
                parseFloat(document.querySelector('[name="high_2"]').value),
                parseFloat(document.querySelector('[name="close_2"]').value)
            ]
        ];

        // 서버로 POST 요청 전송
        fetch('/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({data: data})
        })
            .then(response => response.json())
            .then(result => {
                if (result.error) {
                    document.getElementById('predictionResult').innerText = "오류: " + result.error;
                } else {
                    document.getElementById('predictionResult').innerText = "예측된 종가: " + result.prediction + " 원";
                }
            })
            .catch(error => {
                document.getElementById('predictionResult').innerText = "예측 요청 중 오류 발생";
                console.error('Error:', error);
            });
    }

    // 자동으로 값을 채우는 함수
    function autoFillData() {
        fetch('/get_stock_data')  // 서버에서 최근 2일치 주가 데이터를 가져옴
            .then(response => response.json())
            .then(data => {
                if (data.length >= 2) {
                    // 첫 번째 날 데이터
                    document.querySelector('[name="open_1"]').value = data[0].Open.toFixed(2);
                    document.querySelector('[name="low_1"]').value = data[0].Low.toFixed(2);
                    document.querySelector('[name="high_1"]').value = data[0].High.toFixed(2);
                    document.querySelector('[name="close_1"]').value = data[0].Close.toFixed(2);

                    // 첫 번째 날 날짜 설정
                    document.getElementById('date1').innerText = `첫 번째 날: ${data[0].Date}`;

                    // 두 번째 날 데이터
                    document.querySelector('[name="open_2"]').value = data[1].Open.toFixed(2);
                    document.querySelector('[name="low_2"]').value = data[1].Low.toFixed(2);
                    document.querySelector('[name="high_2"]').value = data[1].High.toFixed(2);
                    document.querySelector('[name="close_2"]').value = data[1].Close.toFixed(2);

                    // 두 번째 날 날짜 설정
                    document.getElementById('date2').innerText = `두 번째 날: ${data[1].Date}`;
                } else {
                    alert("데이터가 충분하지 않습니다.");
                }
            })
            .catch(error => {
                alert("데이터를 가져오는 중 오류가 발생했습니다.");
                console.error('Error:', error);
            });
    }

    // 자동 채우기 다이나믹
    document.getElementById('fetchDataButton').addEventListener('click', function() {
        const selectedPeriod = document.querySelector('input[name="period"]:checked');
        if (!selectedPeriod) {
            alert('기간을 선택하세요.');
            return;
        }

        const periodValue = selectedPeriod.value;

        fetch(`/get_stock_data2?period=${periodValue}`)
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('dataContainer');
                container.innerHTML = ''; // 기존 데이터 초기화

                if (data.length === 0) {
                    container.innerHTML = '<p>데이터가 없습니다.</p>';
                    return;
                }

                // 데이터 표시
                data.forEach((item, index) => {
                    const dataBlock = document.createElement('div');
                    dataBlock.innerHTML = `
                        <h4>${index + 1}번째 날 (${item.Date})</h4>
                        <p>시작가: ${item.Open}</p>
                        <p>최소가: ${item.Low}</p>
                        <p>최대가: ${item.High}</p>
                        <p>종가: ${item.Close}</p>
                        <hr>
                    `;
                    container.appendChild(dataBlock);
                });
            })
            .catch(error => {
                console.error('데이터 가져오는 중 오류 발생:', error);
                alert('데이터를 가져오는 중 오류가 발생했습니다.');
            });
    });

    // 60일치, 데이터 넣는 입력란 만들기.
    document.getElementById('generateButton').addEventListener('click', function() {
        const container = document.getElementById('data-input-container');
        const numDays = parseInt(document.getElementById('numberOfDays').value, 10);

        // Clear any existing content
        container.innerHTML = '';

        if (isNaN(numDays) || numDays < 1 || numDays > 60) {
            alert('1에서 60 사이의 유효한 숫자를 입력하세요.');
            return;
        }

        for (let i = 1; i <= numDays; i++) {
            const daySection = document.createElement('div');
            daySection.innerHTML = `
                <h3 id="date${i}">${i}번째 날</h3>
                시작가: <input type="number" step="0.01" name="open_${i}" required><br>
                최소가: <input type="number" step="0.01" name="low_${i}" required><br>
                최대가: <input type="number" step="0.01" name="high_${i}" required><br>
                종가: <input type="number" step="0.01" name="close_${i}" required><br><br>
            `;
            container.appendChild(daySection);
        }
    });
</script>
</body>
</html>
