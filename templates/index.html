<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>삼성 주가 예측</title>
</head>
<body>
<h1>삼성 주가 예측 모델 (2일 데이터 입력)</h1>
<button onclick="autoFillData()">최근 2일치 데이터 자동 입력</button>
<br><br>

<form id="predictForm">
    <!-- 첫 번째 날 데이터 입력 -->
    <h3 id="date1">첫 번째 날</h3>
    시작가: <input type="number" step="0.01" name="open_1" required><br>
    최소가: <input type="number" step="0.01" name="low_1" required><br>
    최대가: <input type="number" step="0.01" name="high_1" required><br>
    종가: <input type="number" step="0.01" name="close_1" required><br><br>

    <!-- 두 번째 날 데이터 입력 -->
    <h3 id="date2">두 번째 날</h3>
    시작가: <input type="number" step="0.01" name="open_2" required><br>
    최소가: <input type="number" step="0.01" name="low_2" required><br>
    최대가: <input type="number" step="0.01" name="high_2" required><br>
    종가: <input type="number" step="0.01" name="close_2" required><br><br>

    <button type="button" onclick="makePrediction()">예측하기</button>
</form>

<!-- 예측 결과 표시 -->
<h2 id="predictionResult"></h2>

<script>
    // 입력 데이터를 JSON 형식으로 변환하여 서버로 전송
    function makePrediction() {
        // 첫 번째 날과 두 번째 날의 입력 값을 배열로 수집
        const data = [
            [
                parseFloat(document.querySelector('[name="open_1"]').value),
                parseFloat(document.querySelector('[name="low_1"]').value),
                parseFloat(document.querySelector('[name="high_1"]').value),
                parseFloat(document.querySelector('[name="close_1"]').value)
            ],
            [
                parseFloat(document.querySelector('[name="open_2"]').value),
                parseFloat(document.querySelector('[name="low_2"]').value),
                parseFloat(document.querySelector('[name="high_2"]').value),
                parseFloat(document.querySelector('[name="close_2"]').value)
            ]
        ];

        // 서버로 POST 요청 전송
        fetch('/predict', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({data: data})
        })
            .then(response => response.json())
            .then(result => {
                if (result.error) {
                    document.getElementById('predictionResult').innerText = "오류: " + result.error;
                } else {
                    document.getElementById('predictionResult').innerText = "예측된 종가: " + result.prediction + " 원";
                }
            })
            .catch(error => {
                document.getElementById('predictionResult').innerText = "예측 요청 중 오류 발생";
                console.error('Error:', error);
            });
    }

    // 자동으로 값을 채우는 함수
    function autoFillData() {
        fetch('/get_stock_data')  // 서버에서 최근 2일치 주가 데이터를 가져옴
            .then(response => response.json())
            .then(data => {
                if (data.length >= 2) {
                    // 첫 번째 날 데이터
                    document.querySelector('[name="open_1"]').value = data[0].Open.toFixed(2);
                    document.querySelector('[name="low_1"]').value = data[0].Low.toFixed(2);
                    document.querySelector('[name="high_1"]').value = data[0].High.toFixed(2);
                    document.querySelector('[name="close_1"]').value = data[0].Close.toFixed(2);

                    // 첫 번째 날 날짜 설정
                    document.getElementById('date1').innerText = `첫 번째 날: ${data[0].Date}`;

                    // 두 번째 날 데이터
                    document.querySelector('[name="open_2"]').value = data[1].Open.toFixed(2);
                    document.querySelector('[name="low_2"]').value = data[1].Low.toFixed(2);
                    document.querySelector('[name="high_2"]').value = data[1].High.toFixed(2);
                    document.querySelector('[name="close_2"]').value = data[1].Close.toFixed(2);

                    // 두 번째 날 날짜 설정
                    document.getElementById('date2').innerText = `두 번째 날: ${data[1].Date}`;
                } else {
                    alert("데이터가 충분하지 않습니다.");
                }
            })
            .catch(error => {
                alert("데이터를 가져오는 중 오류가 발생했습니다.");
                console.error('Error:', error);
            });
    }
</script>
</body>
</html>
